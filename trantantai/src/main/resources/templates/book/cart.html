<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giỏ Hàng - BookHaven</title>
    <th:block th:replace="~{layout::link-css}"></th:block>
    <th:block th:replace="~{layout::custom-css}"></th:block>
    <style>
        /* ═══════════════════════════════════════════════════════════════════════════
           CART PAGE - Premium Shopping Cart Design
           ═══════════════════════════════════════════════════════════════════════════ */

        .cart-hero {
            background: linear-gradient(135deg, var(--teal-soft) 0%, var(--cloud) 50%, rgba(249, 115, 22, 0.05) 100%);
            border-radius: 24px;
            padding: 2.5rem 2rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }

        .cart-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--teal-muted) 0%, transparent 70%);
            opacity: 0.5;
            pointer-events: none;
        }

        .cart-hero-content {
            position: relative;
            z-index: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .cart-title {
            font-family: var(--font-heading);
            font-size: 2rem;
            font-weight: 800;
            color: var(--ink);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .cart-title svg {
            color: var(--teal);
        }

        .cart-count {
            background: var(--teal);
            color: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        /* Cart Items */
        .cart-items {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .cart-item {
            background: var(--white);
            border-radius: 16px;
            padding: 1.25rem;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            border: 1px solid var(--mist);
            display: flex;
            align-items: center;
            gap: 1.25rem;
            transition: all 0.3s ease;
        }

        .cart-item:hover {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .cart-item-image {
            width: 80px;
            height: 100px;
            background: linear-gradient(135deg, var(--teal) 0%, var(--teal-dark) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .cart-item-image::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 40 40' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M20 20v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4z'/%3E%3C/g%3E%3C/svg%3E");
        }

        .cart-item-image svg {
            color: var(--white);
            opacity: 0.8;
            position: relative;
            z-index: 1;
        }

        .cart-item-details {
            flex: 1;
            min-width: 0;
        }

        .cart-item-name {
            font-family: var(--font-heading);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--ink);
            margin: 0 0 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .cart-item-price {
            font-size: 0.9rem;
            color: var(--slate);
        }

        .cart-item-price span {
            color: var(--teal);
            font-weight: 600;
        }

        /* Quantity Controls */
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 0;
            background: var(--snow);
            border-radius: 10px;
            border: 2px solid var(--mist);
            overflow: hidden;
        }

        .qty-btn {
            width: 38px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--graphite);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .qty-btn:hover {
            background: var(--teal);
            color: var(--white);
        }

        .qty-btn:active {
            transform: scale(0.95);
        }

        .qty-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .qty-btn:disabled:hover {
            background: transparent;
            color: var(--graphite);
        }

        .qty-value {
            width: 50px;
            text-align: center;
            font-family: var(--font-heading);
            font-size: 1rem;
            font-weight: 700;
            color: var(--ink);
            background: var(--white);
            border: none;
            border-left: 1px solid var(--mist);
            border-right: 1px solid var(--mist);
            padding: 0.5rem 0;
        }

        .qty-value:focus {
            outline: none;
        }

        /* Item Total */
        .cart-item-total {
            text-align: right;
            min-width: 100px;
        }

        .cart-item-total-label {
            font-size: 0.75rem;
            color: var(--slate);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .cart-item-total-price {
            font-family: var(--font-heading);
            font-size: 1.25rem;
            font-weight: 800;
            color: var(--coral);
        }

        /* Remove Button */
        .cart-item-remove {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(220, 38, 38, 0.1);
            border: none;
            border-radius: 10px;
            color: var(--danger);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .cart-item-remove:hover {
            background: var(--danger);
            color: var(--white);
            transform: scale(1.05);
        }

        /* Cart Summary */
        .cart-summary {
            background: var(--white);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
            border: 1px solid var(--mist);
        }

        .cart-summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--mist);
        }

        .cart-summary-row:last-of-type {
            border-bottom: none;
            padding-top: 1rem;
            margin-top: 0.5rem;
            border-top: 2px solid var(--mist);
        }

        .cart-summary-label {
            font-size: 0.95rem;
            color: var(--slate);
        }

        .cart-summary-value {
            font-family: var(--font-heading);
            font-weight: 700;
            color: var(--ink);
        }

        .cart-summary-total {
            font-size: 1.5rem;
            color: var(--coral);
        }

        .cart-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .btn-checkout {
            flex: 1;
            padding: 1rem 2rem;
            background: var(--teal);
            color: var(--white);
            font-weight: 700;
            font-size: 1rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-checkout:hover {
            background: var(--teal-dark);
            transform: translateY(-2px);
            color: var(--white);
        }

        .btn-clear {
            padding: 1rem 1.5rem;
            background: transparent;
            color: var(--danger);
            font-weight: 600;
            font-size: 0.9rem;
            border: 2px solid rgba(220, 38, 38, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
        }

        .btn-clear:hover {
            background: var(--danger);
            border-color: var(--danger);
            color: var(--white);
        }

        /* Empty Cart */
        .empty-cart {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--snow);
            border-radius: 24px;
            border: 2px dashed var(--mist);
        }

        .empty-cart-icon {
            width: 100px;
            height: 100px;
            background: var(--white);
            border-radius: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }

        .empty-cart-icon svg {
            width: 48px;
            height: 48px;
            color: var(--pebble);
        }

        .empty-cart h3 {
            font-family: var(--font-heading);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--ink);
            margin-bottom: 0.5rem;
        }

        .empty-cart p {
            color: var(--slate);
            margin-bottom: 1.5rem;
        }

        .btn-shop {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: var(--teal);
            color: var(--white);
            font-weight: 700;
            border-radius: 12px;
            text-decoration: none;
            transition: all 0.3s ease;
        }

        .btn-shop:hover {
            background: var(--teal-dark);
            transform: translateY(-2px);
            color: var(--white);
        }

        /* Success State */
        .success-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            background: rgba(22, 163, 74, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
        }

        .success-icon svg {
            width: 56px;
            height: 56px;
            color: var(--success);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .cart-hero {
                padding: 1.5rem;
            }

            .cart-title {
                font-size: 1.5rem;
            }

            .cart-item {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .cart-item-image {
                width: 60px;
                height: 75px;
            }

            .cart-item-details {
                flex: 1;
                min-width: calc(100% - 80px);
            }

            .quantity-control {
                order: 1;
            }

            .cart-item-total {
                order: 2;
                text-align: left;
            }

            .cart-item-remove {
                order: 3;
            }

            .cart-actions {
                flex-direction: column;
            }

            .btn-clear {
                justify-content: center;
            }
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
<th:block th:replace="~{layout::header}"></th:block>

<main class="flex-grow-1">
    <div class="container animate-fade-in">
        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
            </svg>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Đóng"></button>
        </div>
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
            </svg>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Đóng"></button>
        </div>
        <div th:if="${warning}" class="alert alert-warning alert-dismissible fade show" role="alert">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
            </svg>
            <span th:text="${warning}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Đóng"></button>
        </div>

        <!-- Cart with Items -->
        <div th:if="${not #lists.isEmpty(cart.cartItems)}">
            <!-- Hero -->
            <div class="cart-hero">
                <div class="cart-hero-content">
                    <h1 class="cart-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l.84 4.479 9.144-.459L13.89 4zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                        </svg>
                        Giỏ Hàng
                    </h1>
                    <span class="cart-count" th:text="${#lists.size(cart.cartItems)} + ' sản phẩm'">0 sản phẩm</span>
                </div>
            </div>

            <div class="row g-4">
                <!-- Cart Items -->
                <div class="col-lg-8">
                    <div class="cart-items">
                        <div class="cart-item" th:each="item : ${cart.cartItems}">
                            <!-- Book Image -->
                            <div class="cart-item-image">
                                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492z"/>
                                </svg>
                            </div>

                            <!-- Book Details -->
                            <div class="cart-item-details">
                                <h3 class="cart-item-name" th:text="${item.getBookName()}">Tên Sách</h3>
                                <p class="cart-item-price">Đơn giá: <span th:text="${#numbers.formatDecimal(item.getPrice(), 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span></p>
                            </div>

                            <!-- Quantity Control -->
                            <div class="quantity-control">
                                <button type="button" class="qty-btn qty-decrease"
                                        th:data-id="${item.getBookId()}"
                                        th:disabled="${item.getQuantity() <= 1}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8"/>
                                    </svg>
                                </button>
                                <input type="text" class="qty-value"
                                       th:value="${item.getQuantity()}"
                                       th:data-id="${item.getBookId()}"
                                       readonly>
                                <button type="button" class="qty-btn qty-increase"
                                        th:data-id="${item.getBookId()}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4"/>
                                    </svg>
                                </button>
                            </div>

                            <!-- Item Total -->
                            <div class="cart-item-total">
                                <div class="cart-item-total-label">Thành tiền</div>
                                <div class="cart-item-total-price" th:text="${#numbers.formatDecimal(item.getPrice() * item.getQuantity(), 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</div>
                            </div>

                            <!-- Remove Button -->
                            <a class="cart-item-remove"
                               th:href="@{/cart/removeFromCart/{id}(id=${item.getBookId()})}"
                               onclick="return confirm('Xóa sách này khỏi giỏ hàng?')"
                               title="Xóa">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Cart Summary -->
                <div class="col-lg-4">
                    <div class="cart-summary">
                        <h3 style="font-family: var(--font-heading); font-weight: 700; margin-bottom: 1.5rem;">Tóm Tắt Đơn Hàng</h3>

                        <div class="cart-summary-row">
                            <span class="cart-summary-label">Tạm tính</span>
                            <span class="cart-summary-value" th:text="${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span>
                        </div>
                        <div class="cart-summary-row">
                            <span class="cart-summary-label">Phí vận chuyển</span>
                            <span class="cart-summary-value" style="color: var(--success);">Miễn phí</span>
                        </div>
                        <div class="cart-summary-row">
                            <span class="cart-summary-label" style="font-weight: 700; color: var(--ink);">Tổng cộng</span>
                            <span class="cart-summary-value cart-summary-total" th:text="${#numbers.formatDecimal(totalPrice, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</span>
                        </div>

                        <div class="cart-actions">
                            <a class="btn-checkout" th:href="@{/cart/checkout}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
                                    <path d="M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                                </svg>
                                Thanh Toán
                            </a>
                            <a class="btn-clear" th:href="@{/cart/clearCart}"
                               onclick="return confirm('Bạn có chắc muốn xóa toàn bộ giỏ hàng?')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/>
                                    <path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/>
                                </svg>
                                Xóa tất cả
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty Cart -->
        <div th:if="${#lists.isEmpty(cart.cartItems) and success == null}" class="empty-cart">
            <div class="empty-cart-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .49.598l-1 5a.5.5 0 0 1-.465.401l-9.397.472L4.415 11H13a.5.5 0 0 1 0 1H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l.84 4.479 9.144-.459L13.89 4zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>
                </svg>
            </div>
            <h3>Giỏ hàng trống</h3>
            <p>Hãy thêm vài cuốn sách yêu thích vào giỏ hàng của bạn!</p>
            <a class="btn-shop" href="/books">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492z"/>
                </svg>
                Khám Phá Sách
            </a>
        </div>

        <!-- Order Success -->
        <div th:if="${#lists.isEmpty(cart.cartItems) and success != null}" class="success-state">
            <div class="success-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </svg>
            </div>
            <h2 style="color: var(--success); font-family: var(--font-heading); font-weight: 700; margin-bottom: 0.5rem;">Đặt hàng thành công!</h2>
            <p style="color: var(--slate); margin-bottom: 1.5rem;">Cảm ơn bạn đã mua hàng tại BookHaven</p>
            <a class="btn-shop" href="/books">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9"/>
                    <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z"/>
                </svg>
                Tiếp Tục Mua Sắm
            </a>
        </div>
    </div>
</main>

<th:block th:replace="~{layout::footer}"></th:block>

<script>
// Quantity increase/decrease handlers
document.querySelectorAll('.qty-decrease').forEach(btn => {
    btn.addEventListener('click', function() {
        const bookId = this.dataset.id;
        const input = this.parentElement.querySelector('.qty-value');
        let qty = parseInt(input.value);
        if (qty > 1) {
            updateQuantity(bookId, qty - 1);
        }
    });
});

document.querySelectorAll('.qty-increase').forEach(btn => {
    btn.addEventListener('click', function() {
        const bookId = this.dataset.id;
        const input = this.parentElement.querySelector('.qty-value');
        let qty = parseInt(input.value);
        updateQuantity(bookId, qty + 1);
    });
});

function updateQuantity(bookId, quantity) {
    fetch('/cart/updateQuantity', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: `id=${bookId}&quantity=${quantity}`
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Reload page to update all prices
            location.reload();
        } else {
            alert(data.message || 'Có lỗi xảy ra');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Có lỗi xảy ra. Vui lòng thử lại!');
    });
}
</script>
</body>
</html>
