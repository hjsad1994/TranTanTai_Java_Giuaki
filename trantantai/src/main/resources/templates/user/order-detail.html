<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${pageTitle} + ' - BookHaven'">Chi tiết đơn hàng - BookHaven</title>
    <th:block th:replace="~{layout::link-css}"></th:block>
    <th:block th:replace="~{layout::custom-css}"></th:block>
    <style>
        /* ═══════════════════════════════════════════════════════════════════════════
           ORDER DETAIL PAGE - Premium Order Tracking Experience
           ═══════════════════════════════════════════════════════════════════════════ */

        .order-detail-container {
            max-width: 900px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
        }

        /* Breadcrumb */
        .breadcrumb-nav {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
            font-size: 0.9rem;
        }

        .breadcrumb-nav a {
            color: var(--slate);
            text-decoration: none;
            transition: color var(--transition-fast);
        }

        .breadcrumb-nav a:hover {
            color: var(--teal);
        }

        .breadcrumb-nav svg {
            color: var(--stone);
        }

        .breadcrumb-nav span {
            color: var(--teal);
            font-weight: 600;
        }

        /* Order Header Card */
        .order-header-card {
            background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%);
            border-radius: var(--radius-2xl);
            padding: var(--space-2xl);
            margin-bottom: var(--space-xl);
            color: var(--white);
            position: relative;
            overflow: hidden;
        }

        .order-header-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 400px;
            height: 400px;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            pointer-events: none;
        }

        .order-header-content {
            position: relative;
            z-index: 1;
        }

        .order-header-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--space-xl);
            gap: var(--space-lg);
            flex-wrap: wrap;
        }

        .order-id-section h1 {
            font-family: var(--font-mono);
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 var(--space-xs) 0;
            display: flex;
            align-items: center;
            gap: var(--space-sm);
        }

        .order-date-text {
            font-size: 0.9rem;
            opacity: 0.9;
            display: flex;
            align-items: center;
            gap: var(--space-xs);
        }

        .order-status-section {
            text-align: right;
        }

        .status-large {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-lg);
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            border-radius: var(--radius-full);
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Progress Timeline */
        .progress-timeline {
            display: flex;
            justify-content: space-between;
            position: relative;
            margin-top: var(--space-lg);
        }

        .progress-timeline::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50px;
            right: 50px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: var(--radius-full);
        }

        .progress-timeline::after {
            content: '';
            position: absolute;
            top: 20px;
            left: 50px;
            height: 4px;
            background: var(--white);
            border-radius: var(--radius-full);
            transition: width 0.5s ease;
        }

        .progress-timeline.status-processing::after { width: calc(33% - 50px); }
        .progress-timeline.status-shipped::after { width: calc(66% - 50px); }
        .progress-timeline.status-delivered::after { width: calc(100% - 100px); }
        .progress-timeline.status-cancelled::after { width: 0; background: #ef4444; }

        .timeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--space-sm);
            position: relative;
            z-index: 1;
        }

        .timeline-icon {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            border: 3px solid rgba(255, 255, 255, 0.4);
            transition: all var(--transition-base);
        }

        .timeline-step.completed .timeline-icon,
        .timeline-step.active .timeline-icon {
            background: var(--white);
            border-color: var(--white);
            color: var(--teal);
        }

        .timeline-step.cancelled .timeline-icon {
            background: #ef4444;
            border-color: #ef4444;
            color: var(--white);
        }

        .timeline-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            opacity: 0.7;
        }

        .timeline-step.completed .timeline-label,
        .timeline-step.active .timeline-label {
            opacity: 1;
        }

        .timeline-time {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        /* Info Cards */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .info-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--mist);
        }

        .info-card-title {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 700;
            color: var(--ink);
            margin: 0 0 var(--space-lg) 0;
            padding-bottom: var(--space-md);
            border-bottom: 2px solid var(--mist);
        }

        .info-card-title svg {
            color: var(--teal);
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
        }

        .info-row:not(:last-child) {
            border-bottom: 1px dashed var(--mist);
        }

        .info-label {
            font-size: 0.9rem;
            color: var(--slate);
        }

        .info-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--ink);
        }

        .info-value.success { color: var(--success); }
        .info-value.warning { color: var(--warning); }
        .info-value.danger { color: var(--danger); }
        .info-value.teal { color: var(--teal); }

        /* Items Card */
        .items-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--mist);
            overflow: hidden;
            margin-bottom: var(--space-xl);
        }

        .items-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg) var(--space-xl);
            background: var(--cloud);
            border-bottom: 1px solid var(--mist);
        }

        .items-card-header h2 {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--ink);
            margin: 0;
        }

        .items-card-header h2 svg {
            color: var(--teal);
        }

        .items-count {
            padding: 4px 12px;
            background: var(--teal-muted);
            color: var(--teal);
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
        }

        .items-list {
            padding: var(--space-lg) var(--space-xl);
        }

        .item-row {
            display: flex;
            align-items: center;
            gap: var(--space-lg);
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--mist);
        }

        .item-row:last-child {
            border-bottom: none;
        }

        .item-cover {
            width: 60px;
            height: 80px;
            background: var(--gradient-teal);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
        }

        .item-cover::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 8px;
            background: linear-gradient(90deg, var(--teal-dark) 0%, var(--teal) 50%, var(--teal-dark) 100%);
            border-radius: var(--radius-md) 0 0 var(--radius-md);
        }

        .item-cover svg {
            color: rgba(255, 255, 255, 0.9);
        }

        .item-details {
            flex: 1;
            min-width: 0;
        }

        .item-title {
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 600;
            color: var(--ink);
            margin: 0 0 4px 0;
        }

        .item-author {
            font-size: 0.85rem;
            color: var(--slate);
            font-style: italic;
            margin: 0 0 var(--space-xs) 0;
        }

        .item-unit-price {
            font-size: 0.8rem;
            color: var(--pebble);
        }

        .item-quantity {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0 var(--space-lg);
        }

        .qty-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--slate);
            margin-bottom: 2px;
        }

        .qty-value {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--graphite);
        }

        .item-subtotal {
            text-align: right;
            min-width: 100px;
        }

        .subtotal-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            color: var(--slate);
            margin-bottom: 2px;
        }

        .subtotal-value {
            font-family: var(--font-mono);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--teal);
        }

        /* Order Summary */
        .order-summary {
            background: linear-gradient(135deg, #f0fdfa 0%, var(--cloud) 100%);
            border-top: 2px solid var(--teal-muted);
            padding: var(--space-xl);
        }

        .summary-row {
            display: flex;
            justify-content: flex-end;
            align-items: center;
            gap: var(--space-xl);
            padding: var(--space-xs) 0;
        }

        .summary-row.total {
            padding-top: var(--space-md);
            margin-top: var(--space-md);
            border-top: 2px dashed var(--teal-muted);
        }

        .summary-label {
            font-size: 0.95rem;
            color: var(--slate);
        }

        .summary-value {
            font-family: var(--font-mono);
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--graphite);
            min-width: 120px;
            text-align: right;
        }

        .summary-row.total .summary-label {
            font-family: var(--font-display);
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--ink);
        }

        .summary-row.total .summary-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--teal);
        }

        /* Actions */
        .order-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--space-md);
            flex-wrap: wrap;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-xl);
            background: var(--white);
            color: var(--graphite);
            border: 2px solid var(--mist);
            border-radius: var(--radius-full);
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            transition: all var(--transition-base);
        }

        .btn-back:hover {
            border-color: var(--teal);
            color: var(--teal);
            background: var(--teal-muted);
        }

        .btn-reorder {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-xl);
            background: var(--gradient-teal);
            color: var(--white);
            border: none;
            border-radius: var(--radius-full);
            font-family: var(--font-body);
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            transition: all var(--transition-base);
        }

        .btn-reorder:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-teal);
            color: var(--white);
        }

        /* Help Card */
        .help-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-xl);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--mist);
            margin-top: var(--space-xl);
            display: flex;
            align-items: center;
            gap: var(--space-lg);
        }

        .help-icon {
            width: 56px;
            height: 56px;
            background: var(--teal-muted);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--teal);
            flex-shrink: 0;
        }

        .help-content h3 {
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 700;
            color: var(--ink);
            margin: 0 0 var(--space-xs) 0;
        }

        .help-content p {
            font-size: 0.9rem;
            color: var(--slate);
            margin: 0;
        }

        .help-content a {
            color: var(--teal);
            font-weight: 600;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .info-grid {
                grid-template-columns: 1fr;
            }

            .order-header-top {
                flex-direction: column;
            }

            .order-status-section {
                text-align: left;
            }

            .progress-timeline::before,
            .progress-timeline::after {
                left: 30px;
                right: 30px;
            }

            .timeline-icon {
                width: 36px;
                height: 36px;
            }

            .timeline-label {
                font-size: 0.65rem;
            }

            .item-row {
                flex-wrap: wrap;
            }

            .item-details {
                width: calc(100% - 80px);
            }

            .item-quantity, .item-subtotal {
                flex: 1;
            }

            .order-actions {
                flex-direction: column;
            }

            .btn-back, .btn-reorder {
                width: 100%;
                justify-content: center;
            }

            .help-card {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body class="d-flex flex-column min-vh-100">
<th:block th:replace="~{layout::header}"></th:block>

<main class="flex-grow-1">
    <div class="order-detail-container animate-fade-in">
        <!-- Breadcrumb -->
        <nav class="breadcrumb-nav">
            <a href="/">Trang chủ</a>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>
            </svg>
            <a href="/orders">Đơn hàng của tôi</a>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>
            </svg>
            <span th:text="'#' + ${#strings.substring(order.id, 0, 8).toUpperCase()}">#12345678</span>
        </nav>

        <!-- Order Header Card -->
        <div class="order-header-card">
            <div class="order-header-content">
                <div class="order-header-top">
                    <div class="order-id-section">
                        <h1>
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M14 14V4.5L9.5 0H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2M9.5 3A1.5 1.5 0 0 0 11 4.5h2V14a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5.5z"/>
                            </svg>
                            <span th:text="'Đơn hàng #' + ${#strings.substring(order.id, 0, 8).toUpperCase()}">#12345678</span>
                        </h1>
                        <div class="order-date-text">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/>
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/>
                            </svg>
                            Đặt ngày <span th:text="${#dates.format(order.invoiceDate, 'dd/MM/yyyy')} + ' lúc ' + ${#dates.format(order.invoiceDate, 'HH:mm')}">01/01/2024 lúc 12:00</span>
                        </div>
                    </div>
                    <div class="order-status-section">
                        <div class="status-large">
                            <svg th:if="${order.orderStatus.name() == 'PROCESSING'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                                <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52z"/>
                            </svg>
                            <svg th:if="${order.orderStatus.name() == 'SHIPPED'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zM4 11a1 1 0 1 0 0 2 1 1 0 0 0 0-2m8 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
                            </svg>
                            <svg th:if="${order.orderStatus.name() == 'DELIVERED'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                            </svg>
                            <svg th:if="${order.orderStatus.name() == 'CANCELLED'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                            </svg>
                            <span th:text="${order.orderStatus.displayName}">Đang xử lý</span>
                        </div>
                    </div>
                </div>

                <!-- Progress Timeline -->
                <div class="progress-timeline"
                     th:classappend="${'status-' + order.orderStatus.name().toLowerCase()}">
                    <div class="timeline-step completed">
                        <div class="timeline-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Đã đặt</span>
                    </div>

                    <div class="timeline-step"
                         th:classappend="${order.orderStatus.name() != 'CANCELLED' ? 'completed' : ''}">
                        <div class="timeline-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path th:if="${order.orderStatus.name() != 'CANCELLED'}" d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                                <circle th:if="${order.orderStatus.name() == 'CANCELLED'}" cx="8" cy="8" r="5"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Xác nhận</span>
                    </div>

                    <div class="timeline-step"
                         th:classappend="${order.orderStatus.name() == 'SHIPPED' or order.orderStatus.name() == 'DELIVERED' ? 'completed' :
                                         (order.orderStatus.name() == 'PROCESSING' ? 'active' :
                                         (order.orderStatus.name() == 'CANCELLED' ? 'cancelled' : ''))}">
                        <div class="timeline-icon">
                            <svg th:if="${order.orderStatus.name() != 'CANCELLED'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path th:if="${order.orderStatus.name() == 'SHIPPED' or order.orderStatus.name() == 'DELIVERED'}" d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                                <path th:unless="${order.orderStatus.name() == 'SHIPPED' or order.orderStatus.name() == 'DELIVERED'}" d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5z"/>
                            </svg>
                            <svg th:if="${order.orderStatus.name() == 'CANCELLED'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                            </svg>
                        </div>
                        <span class="timeline-label" th:text="${order.orderStatus.name() == 'CANCELLED' ? 'Đã hủy' : 'Vận chuyển'}">Vận chuyển</span>
                    </div>

                    <div class="timeline-step" th:if="${order.orderStatus.name() != 'CANCELLED'}"
                         th:classappend="${order.orderStatus.name() == 'DELIVERED' ? 'completed' :
                                         (order.orderStatus.name() == 'SHIPPED' ? 'active' : '')}">
                        <div class="timeline-icon">
                            <svg th:if="${order.orderStatus.name() == 'DELIVERED'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                            </svg>
                            <svg th:unless="${order.orderStatus.name() == 'DELIVERED'}" xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961z"/>
                            </svg>
                        </div>
                        <span class="timeline-label">Hoàn thành</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Grid -->
        <div class="info-grid">
            <!-- Payment Info -->
            <div class="info-card">
                <h3 class="info-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
                        <path d="M2 10a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1z"/>
                    </svg>
                    Thông tin thanh toán
                </h3>
                <div class="info-row">
                    <span class="info-label">Phương thức</span>
                    <span class="info-value" th:text="${order.paymentMethod.name() == 'COD' ? 'Thanh toán khi nhận hàng' : 'Ví MoMo'}">COD</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Trạng thái</span>
                    <span class="info-value"
                          th:classappend="${order.paymentStatus.name() == 'PAID' ? 'success' :
                                          (order.paymentStatus.name() == 'PAYMENT_FAILED' ? 'danger' : 'warning')}"
                          th:text="${order.paymentStatus.name() == 'PAID' ? 'Đã thanh toán' :
                                    (order.paymentStatus.name() == 'COD_PENDING' ? 'Thanh toán khi nhận' :
                                    (order.paymentStatus.name() == 'PAYMENT_FAILED' ? 'Thất bại' : 'Chờ thanh toán'))}">Chờ thanh toán</span>
                </div>
                <div class="info-row" th:if="${order.momoTransactionId != null}">
                    <span class="info-label">Mã giao dịch</span>
                    <span class="info-value" style="font-family: var(--font-mono); font-size: 0.85rem;" th:text="${order.momoTransactionId}">TXN123456</span>
                </div>
            </div>

            <!-- Order Info -->
            <div class="info-card">
                <h3 class="info-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
                    </svg>
                    Thông tin đơn hàng
                </h3>
                <div class="info-row">
                    <span class="info-label">Mã đơn hàng</span>
                    <span class="info-value teal" style="font-family: var(--font-mono);" th:text="'#' + ${order.id.toUpperCase()}">#ABC123</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Số lượng sản phẩm</span>
                    <span class="info-value" th:text="${order.itemInvoices.size()} + ' sản phẩm'">3 sản phẩm</span>
                </div>
                <div class="info-row">
                    <span class="info-label">Phí vận chuyển</span>
                    <span class="info-value success">Miễn phí</span>
                </div>
            </div>
        </div>

        <!-- Items Card -->
        <div class="items-card">
            <div class="items-card-header">
                <h2>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492z"/>
                    </svg>
                    Chi tiết sản phẩm
                </h2>
                <span class="items-count" th:text="${order.itemInvoices.size()} + ' sách'">3 sách</span>
            </div>

            <div class="items-list">
                <div class="item-row" th:each="item : ${order.itemInvoices}">
                    <div class="item-cover">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492z"/>
                        </svg>
                    </div>
                    <div class="item-details">
                        <h4 class="item-title" th:text="${item.book != null ? item.book.title : 'Sản phẩm'}">Tên sách</h4>
                        <p class="item-author" th:if="${item.book != null}" th:text="${item.book.author}">Tác giả</p>
                        <span class="item-unit-price" th:if="${item.book != null}">
                            Đơn giá: <span th:text="${#numbers.formatDecimal(item.book.price, 0, 'COMMA', 0, 'POINT')}">100,000</span>đ
                        </span>
                    </div>
                    <div class="item-quantity">
                        <span class="qty-label">Số lượng</span>
                        <span class="qty-value" th:text="${item.quantity}">1</span>
                    </div>
                    <div class="item-subtotal">
                        <span class="subtotal-label">Thành tiền</span>
                        <span class="subtotal-value" th:if="${item.book != null}">
                            <span th:text="${#numbers.formatDecimal(item.quantity * item.book.price, 0, 'COMMA', 0, 'POINT')}">100,000</span>đ
                        </span>
                    </div>
                </div>
            </div>

            <div class="order-summary">
                <div class="summary-row">
                    <span class="summary-label">Tạm tính</span>
                    <span class="summary-value">
                        <span th:text="${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')}">500,000</span>đ
                    </span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Phí vận chuyển</span>
                    <span class="summary-value" style="color: var(--success);">Miễn phí</span>
                </div>
                <div class="summary-row total">
                    <span class="summary-label">Tổng cộng</span>
                    <span class="summary-value">
                        <span th:text="${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')}">500,000</span>đ
                    </span>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="order-actions">
            <a href="/orders" class="btn-back">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                </svg>
                Quay lại danh sách
            </a>
            <a href="/books" class="btn-reorder" th:if="${order.orderStatus.name() == 'DELIVERED'}">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41m-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9"/>
                    <path fill-rule="evenodd" d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5 5 0 0 0 8 3M3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9z"/>
                </svg>
                Đặt lại đơn hàng
            </a>
        </div>

        <!-- Help Card -->
        <div class="help-card">
            <div class="help-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14m0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16"/>
                    <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286m1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94"/>
                </svg>
            </div>
            <div class="help-content">
                <h3>Cần hỗ trợ?</h3>
                <p>Nếu bạn có bất kỳ câu hỏi nào về đơn hàng, vui lòng liên hệ <a href="mailto:support@bookhaven.vn">support@bookhaven.vn</a> hoặc gọi <strong>1900 1234</strong></p>
            </div>
        </div>
    </div>
</main>

<th:block th:replace="~{layout::footer}"></th:block>
</body>
</html>
