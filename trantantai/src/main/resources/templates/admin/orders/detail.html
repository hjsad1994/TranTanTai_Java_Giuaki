<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi Tiết Đơn Hàng - BookHaven Admin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/admin.css?v=6}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400;1,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ═══════════════════════════════════════════════════════════════════════════
           ADMIN ORDER DETAIL - Professional Order Management
           ═══════════════════════════════════════════════════════════════════════════ */

        /* Breadcrumb */
        .admin-breadcrumb {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-xl);
            font-size: 0.875rem;
        }

        .admin-breadcrumb a {
            color: var(--admin-text-tertiary);
            text-decoration: none;
            transition: var(--transition-fast);
        }

        .admin-breadcrumb a:hover {
            color: var(--admin-accent);
        }

        .admin-breadcrumb svg {
            color: var(--admin-text-muted);
        }

        .admin-breadcrumb span {
            color: var(--admin-text);
            font-weight: 500;
        }

        /* Order Header */
        .order-detail-header {
            background: linear-gradient(135deg, var(--admin-surface) 0%, var(--admin-bg-secondary) 100%);
            border: 1px solid var(--admin-border);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin-bottom: var(--space-xl);
            position: relative;
            overflow: hidden;
        }

        .order-detail-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--admin-accent);
        }

        .order-header-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: var(--space-xl);
            flex-wrap: wrap;
        }

        .order-main-info h1 {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--admin-text);
            margin: 0 0 var(--space-sm) 0;
        }

        .order-main-info h1 svg {
            color: var(--admin-accent);
        }

        .order-id-display {
            font-family: var(--font-mono);
            color: var(--admin-accent);
        }

        .order-meta {
            display: flex;
            gap: var(--space-xl);
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .meta-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--admin-text-tertiary);
        }

        .meta-value {
            font-size: 0.95rem;
            font-weight: 600;
            color: var(--admin-text);
        }

        .order-badges {
            display: flex;
            flex-direction: column;
            gap: var(--space-sm);
            align-items: flex-end;
        }

        /* Status Badges */
        .status-badge-lg {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-lg);
            border-radius: var(--radius-full);
            font-size: 0.85rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .status-processing {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }

        .status-shipped {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 2px solid rgba(245, 158, 11, 0.3);
        }

        .status-delivered {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 2px solid rgba(16, 185, 129, 0.3);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 2px solid rgba(239, 68, 68, 0.3);
        }

        .payment-badge-lg {
            display: inline-flex;
            align-items: center;
            gap: var(--space-xs);
            padding: 6px 14px;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            background: var(--admin-surface-hover);
            color: var(--admin-text-secondary);
            border: 1px solid var(--admin-border);
        }

        .payment-paid {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border-color: rgba(16, 185, 129, 0.2);
        }

        /* Grid Layout */
        .order-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: var(--space-xl);
        }

        /* Cards */
        .detail-card {
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        .detail-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: var(--space-lg) var(--space-xl);
            background: var(--admin-bg-secondary);
            border-bottom: 1px solid var(--admin-border);
        }

        .detail-card-header h2 {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            font-family: var(--font-display);
            font-size: 1rem;
            font-weight: 700;
            color: var(--admin-text);
            margin: 0;
        }

        .detail-card-header h2 svg {
            color: var(--admin-accent);
        }

        .detail-card-body {
            padding: var(--space-xl);
        }

        /* Items Table */
        .items-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .items-table th {
            padding: var(--space-md) var(--space-lg);
            text-align: left;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--admin-text-tertiary);
            background: var(--admin-bg-secondary);
            border-bottom: 1px solid var(--admin-border);
        }

        .items-table td {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--admin-border);
            vertical-align: middle;
        }

        .items-table tbody tr:hover {
            background: var(--admin-surface-hover);
        }

        .item-info-cell {
            display: flex;
            align-items: center;
            gap: var(--space-md);
        }

        .item-thumb {
            width: 48px;
            height: 64px;
            background: linear-gradient(135deg, var(--admin-accent) 0%, #14b8a6 100%);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            position: relative;
        }

        .item-thumb::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
            background: rgba(0,0,0,0.2);
            border-radius: var(--radius-sm) 0 0 var(--radius-sm);
        }

        .item-thumb svg {
            color: rgba(255, 255, 255, 0.9);
        }

        .item-title {
            font-weight: 600;
            color: var(--admin-text);
            margin-bottom: 2px;
        }

        .item-author {
            font-size: 0.85rem;
            color: var(--admin-text-tertiary);
            font-style: italic;
        }

        .item-qty {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--admin-text);
        }

        .item-price {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--admin-accent);
        }

        /* Order Summary */
        .order-summary-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-sm) 0;
        }

        .order-summary-row:not(:last-child) {
            border-bottom: 1px dashed var(--admin-border);
        }

        .order-summary-row.total {
            padding-top: var(--space-md);
            margin-top: var(--space-md);
            border-top: 2px solid var(--admin-border);
            border-bottom: none;
        }

        .summary-label {
            font-size: 0.9rem;
            color: var(--admin-text-tertiary);
        }

        .summary-value {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--admin-text);
        }

        .order-summary-row.total .summary-label {
            font-size: 1rem;
            font-weight: 700;
            color: var(--admin-text);
        }

        .order-summary-row.total .summary-value {
            font-size: 1.25rem;
            color: var(--admin-accent);
        }

        /* Info Rows */
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-md) 0;
            border-bottom: 1px solid var(--admin-border);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-size: 0.9rem;
            color: var(--admin-text-tertiary);
        }

        .info-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--admin-text);
        }

        .info-value.success { color: #10b981; }
        .info-value.warning { color: #f59e0b; }
        .info-value.danger { color: #ef4444; }
        .info-value.info { color: #3b82f6; }
        .info-value.mono { font-family: var(--font-mono); }

        /* Actions Card */
        .actions-card {
            /* Removed sticky positioning to prevent overlap with timeline card */
            position: relative;
            background: var(--admin-surface);
        }

        /* Right Column */
        .order-right-col {
            display: flex;
            flex-direction: column;
        }

        .action-section {
            padding: var(--space-lg);
            border-bottom: 1px solid var(--admin-border);
        }

        .action-section:last-child {
            border-bottom: none;
        }

        .action-section-title {
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--admin-text-tertiary);
            margin-bottom: var(--space-md);
        }

        .status-select {
            width: 100%;
            padding: var(--space-md);
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: var(--radius-md);
            color: var(--admin-text);
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .status-select:hover {
            border-color: var(--admin-border-hover);
        }

        .status-select:focus {
            outline: none;
            border-color: var(--admin-accent);
            box-shadow: 0 0 0 3px rgba(13, 148, 136, 0.1);
        }

        .btn-update-status {
            width: 100%;
            padding: var(--space-md);
            background: #0d9488 !important;
            color: #ffffff !important;
            border: 2px solid #0d9488 !important;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            margin-top: var(--space-md);
        }

        .btn-update-status:hover {
            background: #0f766e !important;
            color: #ffffff !important;
            border-color: #0f766e !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        .btn-update-status:active {
            background: #115e59 !important;
            color: #ffffff !important;
            transform: translateY(0);
        }

        .btn-cancel-order {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: var(--space-sm);
            padding: var(--space-md);
            background: transparent;
            color: #dc2626;
            border: 2px solid rgba(239, 68, 68, 0.3);
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
        }

        .btn-cancel-order:hover:not(:disabled) {
            background: rgba(239, 68, 68, 0.1);
            border-color: #dc2626;
        }

        .btn-cancel-order:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-back {
            display: inline-flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            background: var(--admin-surface);
            color: var(--admin-text-secondary);
            border: 1px solid var(--admin-border);
            border-radius: var(--radius-md);
            font-weight: 500;
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .btn-back:hover {
            background: var(--admin-surface-hover);
            color: var(--admin-text);
            border-color: var(--admin-border-hover);
        }

        /* Timeline */
        .order-timeline {
            padding: var(--space-lg) 0;
        }

        .timeline-item {
            display: flex;
            gap: var(--space-md);
            padding-bottom: var(--space-lg);
            position: relative;
        }

        .timeline-item:not(:last-child)::after {
            content: '';
            position: absolute;
            left: 15px;
            top: 36px;
            bottom: 0;
            width: 2px;
            background: var(--admin-border);
        }

        .timeline-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--admin-surface-hover);
            border: 2px solid var(--admin-border);
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }

        .timeline-item.completed .timeline-icon {
            background: var(--admin-accent);
            border-color: var(--admin-accent);
            color: white;
        }

        .timeline-item.active .timeline-icon {
            background: white;
            border-color: var(--admin-accent);
            color: var(--admin-accent);
            box-shadow: 0 0 0 4px rgba(13, 148, 136, 0.1);
        }

        .timeline-content {
            flex: 1;
            padding-top: 4px;
        }

        .timeline-title {
            font-weight: 600;
            color: var(--admin-text);
            margin-bottom: 2px;
        }

        .timeline-desc {
            font-size: 0.85rem;
            color: var(--admin-text-tertiary);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .order-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .order-header-content {
                flex-direction: column;
            }

            .order-badges {
                align-items: flex-start;
            }

            .items-table th:nth-child(3),
            .items-table td:nth-child(3) {
                display: none;
            }
        }
    </style>
</head>
<body class="admin-body">
<div class="admin-wrapper">
    <th:block th:replace="~{admin/layout::sidebar}"></th:block>

    <div class="admin-main">
        <th:block th:replace="~{admin/layout::topbar}"></th:block>

        <main class="admin-content">
            <!-- Breadcrumb -->
            <nav class="admin-breadcrumb">
                <a href="/admin">Dashboard</a>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>
                </svg>
                <a href="/admin/orders">Quản lý đơn hàng</a>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>
                </svg>
                <span th:text="'#' + ${#strings.substring(order.id, 0, 8).toUpperCase()}">#12345678</span>
            </nav>

            <!-- Alerts -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </svg>
                <span th:text="${success}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
                    <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                </svg>
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <!-- Order Header -->
            <div class="order-detail-header">
                <div class="order-header-content">
                    <div class="order-main-info">
                        <h1>
                            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l1.25 5h8.22l1.25-5zM5 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0"/>
                            </svg>
                            Đơn hàng <span class="order-id-display" th:text="'#' + ${#strings.substring(order.id, 0, 8).toUpperCase()}">#12345678</span>
                        </h1>
                        <div class="order-meta">
                            <div class="meta-item">
                                <span class="meta-label">Ngày đặt</span>
                                <span class="meta-value" th:text="${#dates.format(order.invoiceDate, 'dd/MM/yyyy HH:mm')}">01/01/2024 12:00</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Tổng tiền</span>
                                <span class="meta-value" style="color: var(--admin-accent);">
                                    <span th:text="${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')}">500,000</span>đ
                                </span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Số sản phẩm</span>
                                <span class="meta-value" th:text="${order.itemInvoices.size()} + ' sách'">3 sách</span>
                            </div>
                        </div>
                    </div>
                    <div class="order-badges">
                        <span class="status-badge-lg"
                              th:classappend="${
                                  order.orderStatus.name() == 'PROCESSING' ? 'status-processing' :
                                  (order.orderStatus.name() == 'SHIPPED' ? 'status-shipped' :
                                  (order.orderStatus.name() == 'DELIVERED' ? 'status-delivered' : 'status-cancelled'))
                              }">
                            <svg th:if="${order.orderStatus.name() == 'PROCESSING'}" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492"/>
                            </svg>
                            <svg th:if="${order.orderStatus.name() == 'SHIPPED'}" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-4 0H.5a.5.5 0 0 1-.5-.5z"/>
                            </svg>
                            <svg th:if="${order.orderStatus.name() == 'DELIVERED'}" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                            </svg>
                            <svg th:if="${order.orderStatus.name() == 'CANCELLED'}" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                            </svg>
                            <span th:text="${order.orderStatus.displayName}">Đang xử lý</span>
                        </span>
                        <span class="payment-badge-lg"
                              th:classappend="${order.paymentStatus.name() == 'PAID' ? 'payment-paid' : ''}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
                            </svg>
                            <span th:text="${order.paymentStatus.name() == 'PAID' ? 'Đã thanh toán' :
                                            (order.paymentStatus.name() == 'COD_PENDING' ? 'COD - Chờ nhận' :
                                            (order.paymentStatus.name() == 'PAYMENT_FAILED' ? 'Thanh toán lỗi' : 'Chờ thanh toán'))}">COD</span>
                        </span>
                    </div>
                </div>
            </div>

            <!-- Main Grid -->
            <div class="order-grid">
                <!-- Left Column -->
                <div class="order-left-col">
                    <!-- Items Card -->
                    <div class="detail-card mb-4">
                        <div class="detail-card-header">
                            <h2>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492z"/>
                                </svg>
                                Chi tiết sản phẩm
                            </h2>
                            <span style="padding: 4px 12px; background: var(--admin-surface-hover); border-radius: var(--radius-full); font-size: 0.8rem; font-weight: 600; color: var(--admin-text-secondary);"
                                  th:text="${order.itemInvoices.size()} + ' sản phẩm'">3 sản phẩm</span>
                        </div>
                        <table class="items-table">
                            <thead>
                                <tr>
                                    <th>Sản phẩm</th>
                                    <th style="text-align: center;">Số lượng</th>
                                    <th style="text-align: right;">Đơn giá</th>
                                    <th style="text-align: right;">Thành tiền</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="item : ${order.itemInvoices}">
                                    <td>
                                        <div class="item-info-cell">
                                            <div class="item-thumb">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                                    <path d="M1 2.828c.885-.37 2.154-.769 3.388-.893 1.33-.134 2.458.063 3.112.752v9.746c-.935-.53-2.12-.603-3.213-.493-1.18.12-2.37.461-3.287.811zm7.5-.141c.654-.689 1.782-.886 3.112-.752 1.234.124 2.503.523 3.388.893v9.923c-.918-.35-2.107-.692-3.287-.81-1.094-.111-2.278-.039-3.213.492z"/>
                                                </svg>
                                            </div>
                                            <div>
                                                <div class="item-title" th:text="${item.book != null ? item.book.title : 'Sản phẩm'}">Tên sách</div>
                                                <div class="item-author" th:if="${item.book != null}" th:text="${item.book.author}">Tác giả</div>
                                            </div>
                                        </div>
                                    </td>
                                    <td style="text-align: center;">
                                        <span class="item-qty" th:text="${item.quantity}">1</span>
                                    </td>
                                    <td style="text-align: right;">
                                        <span th:if="${item.book != null}" th:text="${#numbers.formatDecimal(item.book.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">100,000đ</span>
                                    </td>
                                    <td style="text-align: right;">
                                        <span class="item-price" th:if="${item.book != null}" th:text="${#numbers.formatDecimal(item.quantity * item.book.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">100,000đ</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="detail-card-body" style="background: var(--admin-bg-secondary); border-top: 2px solid var(--admin-border);">
                            <div class="order-summary-row">
                                <span class="summary-label">Tạm tính</span>
                                <span class="summary-value" th:text="${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">500,000đ</span>
                            </div>
                            <div class="order-summary-row">
                                <span class="summary-label">Phí vận chuyển</span>
                                <span class="summary-value" style="color: #10b981;">Miễn phí</span>
                            </div>
                            <div class="order-summary-row total">
                                <span class="summary-label">Tổng cộng</span>
                                <span class="summary-value" th:text="${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">500,000đ</span>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Info Card -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h2>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zm13 4H1v5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1z"/>
                                </svg>
                                Thông tin thanh toán
                            </h2>
                        </div>
                        <div class="detail-card-body">
                            <div class="info-row">
                                <span class="info-label">Phương thức thanh toán</span>
                                <span class="info-value" th:text="${order.paymentMethod.name() == 'COD' ? 'Thanh toán khi nhận hàng (COD)' : 'Ví điện tử MoMo'}">COD</span>
                            </div>
                            <div class="info-row">
                                <span class="info-label">Trạng thái thanh toán</span>
                                <span class="info-value"
                                      th:classappend="${order.paymentStatus.name() == 'PAID' ? 'success' :
                                                      (order.paymentStatus.name() == 'PAYMENT_FAILED' ? 'danger' :
                                                      (order.paymentStatus.name() == 'COD_PENDING' ? 'info' : 'warning'))}"
                                      th:text="${order.paymentStatus.name() == 'PAID' ? 'Đã thanh toán' :
                                                (order.paymentStatus.name() == 'COD_PENDING' ? 'Chờ thanh toán khi nhận' :
                                                (order.paymentStatus.name() == 'PAYMENT_FAILED' ? 'Thanh toán thất bại' : 'Chờ thanh toán'))}">Đang chờ</span>
                            </div>
                            <div class="info-row" th:if="${order.momoTransactionId != null}">
                                <span class="info-label">Mã giao dịch MoMo</span>
                                <span class="info-value mono" th:text="${order.momoTransactionId}">TXN123456</span>
                            </div>
                            <div class="info-row" th:if="${order.momoRequestId != null}">
                                <span class="info-label">Mã yêu cầu MoMo</span>
                                <span class="info-value mono" th:text="${order.momoRequestId}">REQ123456</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="order-right-col">
                    <!-- Actions Card -->
                    <div class="detail-card actions-card mb-4">
                        <div class="detail-card-header">
                            <h2>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872z"/>
                                    <path d="M8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                                </svg>
                                Thao tác
                            </h2>
                        </div>
                        <form th:action="@{/admin/orders/{id}/status(id=${order.id})}" method="post">
                            <div class="action-section">
                                <div class="action-section-title">Cập nhật trạng thái</div>
                                <select name="status" class="status-select">
                                    <option th:each="status : ${orderStatuses}"
                                            th:value="${status}"
                                            th:text="${status.displayName}"
                                            th:selected="${status == order.orderStatus}">
                                    </option>
                                </select>
                                <button type="submit" class="btn-update-status">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                                        <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                                    </svg>
                                    Cập nhật
                                </button>
                            </div>
                        </form>
                        <div class="action-section">
                            <div class="action-section-title">Hành động khác</div>
                            <button type="button"
                                    class="btn-cancel-order"
                                    data-bs-toggle="modal"
                                    data-bs-target="#cancelModal"
                                    th:disabled="${order.orderStatus.name() == 'CANCELLED' or order.orderStatus.name() == 'DELIVERED'}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                                </svg>
                                Hủy đơn hàng
                            </button>
                        </div>
                        <div class="action-section">
                            <a href="/admin/orders" class="btn-back" style="width: 100%; justify-content: center;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8"/>
                                </svg>
                                Quay lại danh sách
                            </a>
                        </div>
                    </div>

                    <!-- Order Timeline Card -->
                    <div class="detail-card">
                        <div class="detail-card-header">
                            <h2>
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71z"/>
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0"/>
                                </svg>
                                Tiến trình đơn hàng
                            </h2>
                        </div>
                        <div class="detail-card-body">
                            <div class="order-timeline">
                                <div class="timeline-item completed">
                                    <div class="timeline-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                                        </svg>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="timeline-title">Đơn hàng đã đặt</div>
                                        <div class="timeline-desc" th:text="${#dates.format(order.invoiceDate, 'dd/MM/yyyy HH:mm')}">01/01/2024 12:00</div>
                                    </div>
                                </div>

                                <div class="timeline-item"
                                     th:classappend="${order.orderStatus.name() != 'CANCELLED' ? 'completed' : ''}">
                                    <div class="timeline-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                            <path th:if="${order.orderStatus.name() != 'CANCELLED'}" d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                                            <circle th:if="${order.orderStatus.name() == 'CANCELLED'}" cx="8" cy="8" r="3"/>
                                        </svg>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="timeline-title">Xác nhận đơn hàng</div>
                                        <div class="timeline-desc">Đơn hàng đã được xác nhận</div>
                                    </div>
                                </div>

                                <div class="timeline-item"
                                     th:if="${order.orderStatus.name() != 'CANCELLED'}"
                                     th:classappend="${order.orderStatus.name() == 'SHIPPED' or order.orderStatus.name() == 'DELIVERED' ? 'completed' :
                                                     (order.orderStatus.name() == 'PROCESSING' ? 'active' : '')}">
                                    <div class="timeline-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                            <path th:if="${order.orderStatus.name() == 'SHIPPED' or order.orderStatus.name() == 'DELIVERED'}" d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                                            <path th:unless="${order.orderStatus.name() == 'SHIPPED' or order.orderStatus.name() == 'DELIVERED'}" d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-4 0z"/>
                                        </svg>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="timeline-title">Đang vận chuyển</div>
                                        <div class="timeline-desc">Đơn hàng đang được giao đến khách</div>
                                    </div>
                                </div>

                                <div class="timeline-item"
                                     th:if="${order.orderStatus.name() != 'CANCELLED'}"
                                     th:classappend="${order.orderStatus.name() == 'DELIVERED' ? 'completed' :
                                                     (order.orderStatus.name() == 'SHIPPED' ? 'active' : '')}">
                                    <div class="timeline-icon">
                                        <svg th:if="${order.orderStatus.name() == 'DELIVERED'}" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                                        </svg>
                                        <svg th:unless="${order.orderStatus.name() == 'DELIVERED'}" xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887z"/>
                                        </svg>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="timeline-title">Giao hàng thành công</div>
                                        <div class="timeline-desc">Khách hàng đã nhận được hàng</div>
                                    </div>
                                </div>

                                <div class="timeline-item completed" th:if="${order.orderStatus.name() == 'CANCELLED'}">
                                    <div class="timeline-icon" style="background: #dc2626; border-color: #dc2626;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                        </svg>
                                    </div>
                                    <div class="timeline-content">
                                        <div class="timeline-title" style="color: #dc2626;">Đơn hàng đã hủy</div>
                                        <div class="timeline-desc">Đơn hàng đã bị hủy bởi admin</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Cancel Confirmation Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content" style="background: var(--admin-surface); border: 1px solid var(--admin-border);">
            <div class="modal-header" style="border-color: var(--admin-border);">
                <h5 class="modal-title" style="color: #dc2626; display: flex; align-items: center; gap: 8px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
                        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                    </svg>
                    Xác nhận hủy đơn hàng
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="color: var(--admin-text);">
                <p>Bạn có chắc chắn muốn hủy đơn hàng <strong style="font-family: var(--font-mono); color: var(--admin-accent);">#<span th:text="${#strings.substring(order.id, 0, 8).toUpperCase()}"></span></strong>?</p>
                <div style="padding: 12px; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 8px; margin-top: 12px;">
                    <p style="margin: 0; font-size: 0.9rem; color: #dc2626;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                        </svg>
                        Khi hủy đơn hàng, số lượng tồn kho sẽ được hoàn lại. Hành động này không thể hoàn tác.
                    </p>
                </div>
            </div>
            <div class="modal-footer" style="border-color: var(--admin-border);">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <form th:action="@{/admin/orders/{id}/cancel(id=${order.id})}" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                        </svg>
                        Xác nhận hủy
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/admin.js}"></script>
</body>
</html>
