<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="vi">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Đơn Hàng - BookHaven Admin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" th:href="@{/css/admin.css?v=7}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,400;1,600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        /* ═══════════════════════════════════════════════════════════════════════════
           ORDER MANAGEMENT PAGE STYLES
           ═══════════════════════════════════════════════════════════════════════════ */

        /* Page Header */
        .page-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: var(--space-xl);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin: 0 0 var(--space-xs);
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--admin-text);
        }

        .page-title svg {
            color: var(--admin-accent);
        }

        .page-subtitle {
            margin: 0;
            color: var(--admin-text-tertiary);
            font-size: 0.9rem;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
        }

        .stat-card {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            padding: var(--space-lg);
            background: var(--admin-surface);
            border: 1px solid var(--admin-border);
            border-radius: var(--radius-lg);
            transition: all 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-card-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-card-total .stat-card-icon { background: rgba(13, 148, 136, 0.1); color: #0d9488; }
        .stat-card-processing .stat-card-icon { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
        .stat-card-shipped .stat-card-icon { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .stat-card-delivered .stat-card-icon { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .stat-card-cancelled .stat-card-icon { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

        .stat-card-value {
            font-family: var(--font-display);
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--admin-text);
            display: block;
        }

        .stat-card-label {
            font-size: 0.8rem;
            color: var(--admin-text-tertiary);
        }

        /* Table Enhancements */
        .table-count {
            font-size: 0.875rem;
            color: var(--admin-text-tertiary);
            margin-left: var(--space-sm);
        }

        .table-search {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-sm) var(--space-md);
            background: var(--admin-surface-hover);
            border: 1px solid var(--admin-border);
            border-radius: var(--radius-md);
        }

        .table-search input {
            background: transparent;
            border: none;
            outline: none;
            color: var(--admin-text);
            font-size: 0.875rem;
            width: 180px;
        }

        .table-search input::placeholder {
            color: var(--admin-text-tertiary);
        }

        .table-search svg {
            color: var(--admin-text-tertiary);
        }

        .table-filter {
            padding: var(--space-sm) var(--space-md);
            background: var(--admin-surface-hover);
            border: 1px solid var(--admin-border);
            border-radius: var(--radius-md);
            color: var(--admin-text);
            font-size: 0.875rem;
            outline: none;
            cursor: pointer;
        }

        .table-filter option {
            background: var(--admin-surface);
        }

        /* Order ID Link */
        .order-id-link {
            text-decoration: none;
        }

        .order-id-link:hover .order-id {
            text-decoration: underline;
        }

        .order-id {
            font-family: var(--font-mono);
            color: #0d9488;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* Date Cell */
        .date-cell {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .date-main {
            font-weight: 500;
            color: var(--admin-text);
        }

        .date-time {
            font-size: 0.75rem;
            color: var(--admin-text-tertiary);
        }

        /* Items Count */
        .items-count {
            font-size: 0.85rem;
            color: var(--admin-text-secondary);
        }

        /* Price */
        .price-value {
            font-family: var(--font-mono);
            font-weight: 600;
            color: var(--admin-text);
        }

        /* Payment Badge */
        .payment-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.02em;
        }

        .payment-paid {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .payment-pending {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .payment-failed {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-processing {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .status-shipped {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-delivered {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-cancelled {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* ═══════════════════════════════════════════════════════════════════════════
           ACTION BUTTONS - Clear and Visible
           ═══════════════════════════════════════════════════════════════════════════ */
        .action-cell {
            white-space: nowrap;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .btn-action {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 14px;
            font-size: 0.8rem;
            font-weight: 600;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
        }

        .btn-action-view {
            background: linear-gradient(135deg, #0d9488 0%, #14b8a6 100%);
            color: white;
        }

        .btn-action-view:hover {
            background: linear-gradient(135deg, #0f766e 0%, #0d9488 100%);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(13, 148, 136, 0.3);
        }

        .btn-action-edit {
            background: #f59e0b;
            color: white;
        }

        .btn-action-edit:hover {
            background: #d97706;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.3);
        }

        .btn-action-delete {
            background: #ef4444;
            color: white;
        }

        .btn-action-delete:hover {
            background: #dc2626;
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }

        .btn-action-secondary {
            background: #f5f5f4;
            color: #44403c;
            border: 1px solid #e7e5e4;
        }

        .btn-action-secondary:hover {
            background: #e7e5e4;
            color: #1c1917;
            transform: translateY(-1px);
        }

        /* Dropdown Styles */
        .action-dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-toggle::after {
            display: none;
        }

        .action-dropdown .dropdown-menu {
            background: white;
            border: 1px solid #e7e5e4;
            box-shadow: 0 10px 40px rgba(0,0,0,0.12);
            border-radius: 12px;
            padding: 8px;
            min-width: 200px;
        }

        .action-dropdown .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            font-size: 0.875rem;
            color: #44403c;
            border-radius: 8px;
            transition: all 0.15s ease;
        }

        .action-dropdown .dropdown-item:hover {
            background: #f5f5f4;
            color: #1c1917;
        }

        .action-dropdown .dropdown-item.text-danger {
            color: #dc2626;
        }

        .action-dropdown .dropdown-item.text-danger:hover {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }

        .action-dropdown .dropdown-divider {
            margin: 8px 0;
            border-color: #e7e5e4;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .status-dot-processing { background: #3b82f6; }
        .status-dot-shipped { background: #f59e0b; }
        .status-dot-delivered { background: #10b981; }

        /* Table Empty */
        .table-empty {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: var(--admin-text-tertiary);
        }

        .table-empty svg {
            margin-bottom: 16px;
            opacity: 0.5;
            color: var(--admin-text-tertiary);
        }

        .table-empty h3 {
            margin: 0 0 8px;
            color: var(--admin-text);
            font-weight: 600;
        }

        .table-empty p {
            margin: 0;
            font-size: 0.95rem;
        }

        /* Pagination */
        .table-pagination {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 24px;
            border-top: 1px solid var(--admin-border);
        }

        .pagination-info {
            font-size: 0.875rem;
            color: var(--admin-text-tertiary);
        }

        .pagination {
            display: flex;
            gap: 6px;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .page-item .page-link {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            height: 36px;
            padding: 0 10px;
            background: white;
            border: 1px solid #e7e5e4;
            border-radius: 8px;
            color: #44403c;
            font-size: 0.875rem;
            text-decoration: none;
            transition: all 0.2s ease;
        }

        .page-item .page-link:hover {
            background: #f5f5f4;
            color: #1c1917;
        }

        .page-item.active .page-link {
            background: #0d9488;
            border-color: #0d9488;
            color: white;
        }

        .page-item.disabled .page-link {
            opacity: 0.5;
            pointer-events: none;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 16px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .table-actions {
                flex-direction: column;
                width: 100%;
            }

            .table-search, .table-filter {
                width: 100%;
            }

            .table-search input {
                width: 100%;
            }

            .action-buttons {
                flex-direction: column;
            }
        }

        @media (max-width: 576px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Alerts */
        .alert {
            border: none;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
    </style>
</head>
<body class="admin-body">
<div class="admin-wrapper">
    <th:block th:replace="~{admin/layout::sidebar}"></th:block>

    <div class="admin-main">
        <th:block th:replace="~{admin/layout::topbar}"></th:block>

        <main class="admin-content">
            <!-- Alerts -->
            <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
                </svg>
                <span th:text="${success}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-2" viewBox="0 0 16 16">
                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
                    <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                </svg>
                <span th:text="${error}"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <!-- Page Header -->
            <div class="page-header">
                <div class="page-header-content">
                    <h1 class="page-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l1.25 5h8.22l1.25-5zM5 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0"/>
                        </svg>
                        Quản Lý Đơn Hàng
                    </h1>
                    <p class="page-subtitle">Quản lý và theo dõi trạng thái đơn đặt hàng</p>
                </div>
            </div>

            <!-- Stats Summary -->
            <div class="stats-grid">
                <div class="stat-card stat-card-total">
                    <div class="stat-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8.186 1.113a.5.5 0 0 0-.372 0L1.846 3.5l2.404.961L10.404 2l-2.218-.887zm3.564 1.426L5.596 5 8 5.961 14.154 3.5l-2.404-.961zm3.25 1.7-6.5 2.6v7.922l6.5-2.6V4.24zM7.5 14.762V6.838L1 4.239v7.923l6.5 2.6zM7.443.184a1.5 1.5 0 0 1 1.114 0l7.129 2.852A.5.5 0 0 1 16 3.5v8.662a1 1 0 0 1-.629.928l-7.185 2.874a.5.5 0 0 1-.372 0L.63 13.09a1 1 0 0 1-.63-.928V3.5a.5.5 0 0 1 .314-.464L7.443.184z"/>
                        </svg>
                    </div>
                    <div class="stat-card-content">
                        <span class="stat-card-value" th:text="${orderStats['total'] ?: 0}">0</span>
                        <span class="stat-card-label">Tổng đơn hàng</span>
                    </div>
                </div>
                <div class="stat-card stat-card-processing">
                    <div class="stat-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492M5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0"/>
                            <path d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52z"/>
                        </svg>
                    </div>
                    <div class="stat-card-content">
                        <span class="stat-card-value" th:text="${orderStats['processing'] ?: 0}">0</span>
                        <span class="stat-card-label">Đang xử lý</span>
                    </div>
                </div>
                <div class="stat-card stat-card-shipped">
                    <div class="stat-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zM4 11a1 1 0 1 0 0 2 1 1 0 0 0 0-2m8 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2"/>
                        </svg>
                    </div>
                    <div class="stat-card-content">
                        <span class="stat-card-value" th:text="${orderStats['shipped'] ?: 0}">0</span>
                        <span class="stat-card-label">Đang giao</span>
                    </div>
                </div>
                <div class="stat-card stat-card-delivered">
                    <div class="stat-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425z"/>
                        </svg>
                    </div>
                    <div class="stat-card-content">
                        <span class="stat-card-value" th:text="${orderStats['delivered'] ?: 0}">0</span>
                        <span class="stat-card-label">Đã giao</span>
                    </div>
                </div>
                <div class="stat-card stat-card-cancelled">
                    <div class="stat-card-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                        </svg>
                    </div>
                    <div class="stat-card-content">
                        <span class="stat-card-value" th:text="${orderStats['cancelled'] ?: 0}">0</span>
                        <span class="stat-card-label">Đã hủy</span>
                    </div>
                </div>
            </div>

            <!-- Table Card -->
            <div class="admin-table-card">
                <div class="table-header">
                    <div class="table-title">
                        <h2>Danh sách đơn hàng</h2>
                        <span class="table-count" th:text="'(' + (${totalOrders} ?: 0) + ' đơn)'">(0 đơn)</span>
                    </div>
                    <div class="table-actions">
                        <div class="table-search">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                            </svg>
                            <input type="text" placeholder="Tìm mã đơn..." id="searchInput">
                        </div>
                        <select class="table-filter" id="statusFilter">
                            <option value="">Tất cả trạng thái</option>
                            <option th:each="status : ${orderStatuses}" th:value="${status}" th:text="${status.displayName}"></option>
                        </select>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="admin-table" id="ordersTable">
                        <thead>
                        <tr>
                            <th>Mã đơn</th>
                            <th>Ngày đặt</th>
                            <th>Sản phẩm</th>
                            <th>Tổng tiền</th>
                            <th>Thanh toán</th>
                            <th>Trạng thái</th>
                            <th style="width: 250px; text-align: center;">Thao tác</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="order : ${orders}" th:data-status="${order.orderStatus}">
                            <td>
                                <a th:href="@{/admin/orders/{id}(id=${order.id})}" class="order-id-link">
                                    <span class="order-id" th:text="'#' + ${#strings.substring(order.id, 0, 8).toUpperCase()}">#12345678</span>
                                </a>
                            </td>
                            <td>
                                <div class="date-cell">
                                    <span class="date-main" th:text="${order.invoiceDate != null ? #dates.format(order.invoiceDate, 'dd/MM/yyyy') : 'N/A'}">01/01/2023</span>
                                    <span class="date-time" th:text="${order.invoiceDate != null ? #dates.format(order.invoiceDate, 'HH:mm') : ''}">12:00</span>
                                </div>
                            </td>
                            <td>
                                <span class="items-count" th:text="${order.itemInvoices != null ? order.itemInvoices.size() : 0} + ' sản phẩm'">3 sản phẩm</span>
                            </td>
                            <td>
                                <span class="price-value" th:text="${#numbers.formatDecimal(order.price, 0, 'COMMA', 0, 'POINT')} + 'đ'">100.000đ</span>
                            </td>
                            <td>
                                <span class="payment-badge"
                                      th:classappend="${order.paymentStatus.name() == 'PAID' ? 'payment-paid' :
                                                      (order.paymentStatus.name() == 'PAYMENT_FAILED' ? 'payment-failed' : 'payment-pending')}"
                                      th:text="${order.paymentStatus.name() == 'PAID' ? 'Đã thanh toán' :
                                                (order.paymentStatus.name() == 'COD_PENDING' ? 'COD' :
                                                (order.paymentStatus.name() == 'PAYMENT_FAILED' ? 'Thất bại' : 'Chờ TT'))}">PAID</span>
                            </td>
                            <td>
                                <span class="status-badge"
                                      th:classappend="${
                                        order.orderStatus.name() == 'PROCESSING' ? 'status-processing' :
                                        (order.orderStatus.name() == 'SHIPPED' ? 'status-shipped' :
                                        (order.orderStatus.name() == 'DELIVERED' ? 'status-delivered' :
                                        (order.orderStatus.name() == 'CANCELLED' ? 'status-cancelled' : '')))
                                      }"
                                      th:text="${order.orderStatus.displayName}">PROCESSING</span>
                            </td>
                            <td class="action-cell">
                                <div class="action-buttons">
                                    <!-- View Button -->
                                    <a th:href="@{/admin/orders/{id}(id=${order.id})}" class="btn-action btn-action-view" title="Xem chi tiết">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                            <path d="M10.5 8a2.5 2.5 0 1 1-5 0 2.5 2.5 0 0 1 5 0"/>
                                            <path d="M0 8s3-5.5 8-5.5S16 8 16 8s-3 5.5-8 5.5S0 8 0 8m8 3.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"/>
                                        </svg>
                                        Xem
                                    </a>

                                    <!-- Status Dropdown -->
                                    <div class="action-dropdown dropdown">
                                        <button class="btn-action btn-action-edit dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293z"/>
                                            </svg>
                                            Cập nhật
                                        </button>
                                        <ul class="dropdown-menu dropdown-menu-end">
                                            <li>
                                                <form th:action="@{/admin/orders/{id}/status(id=${order.id})}" method="post">
                                                    <input type="hidden" name="status" value="PROCESSING">
                                                    <button type="submit" class="dropdown-item" th:disabled="${order.orderStatus.name() == 'PROCESSING' or order.orderStatus.name() == 'CANCELLED'}">
                                                        <span class="status-dot status-dot-processing"></span>
                                                        Đang xử lý
                                                    </button>
                                                </form>
                                            </li>
                                            <li>
                                                <form th:action="@{/admin/orders/{id}/status(id=${order.id})}" method="post">
                                                    <input type="hidden" name="status" value="SHIPPED">
                                                    <button type="submit" class="dropdown-item" th:disabled="${order.orderStatus.name() == 'SHIPPED' or order.orderStatus.name() == 'DELIVERED' or order.orderStatus.name() == 'CANCELLED'}">
                                                        <span class="status-dot status-dot-shipped"></span>
                                                        Đang giao hàng
                                                    </button>
                                                </form>
                                            </li>
                                            <li>
                                                <form th:action="@{/admin/orders/{id}/status(id=${order.id})}" method="post">
                                                    <input type="hidden" name="status" value="DELIVERED">
                                                    <button type="submit" class="dropdown-item" th:disabled="${order.orderStatus.name() == 'DELIVERED' or order.orderStatus.name() == 'CANCELLED'}">
                                                        <span class="status-dot status-dot-delivered"></span>
                                                        Đã giao hàng
                                                    </button>
                                                </form>
                                            </li>
                                            <li><hr class="dropdown-divider"></li>
                                            <li>
                                                <button type="button" class="dropdown-item text-danger cancel-order-btn"
                                                        th:data-order-id="${order.id}"
                                                        th:data-order-code="${#strings.substring(order.id, 0, 8).toUpperCase()}"
                                                        th:disabled="${order.orderStatus.name() == 'CANCELLED' or order.orderStatus.name() == 'DELIVERED'}">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                                    </svg>
                                                    Hủy đơn hàng
                                                </button>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Empty State -->
                <div class="table-empty" th:if="${orders.empty}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5"/>
                    </svg>
                    <h3>Chưa có đơn hàng nào</h3>
                    <p>Đơn hàng mới sẽ xuất hiện tại đây khi khách hàng đặt mua sách.</p>
                </div>

                <!-- Pagination -->
                <div class="table-pagination" th:if="${totalPages != null and totalPages > 0}">
                    <div class="pagination-info">
                        Hiển thị <span th:text="${orders.size()}">10</span> / <span th:text="${totalOrders}">100</span> đơn hàng
                    </div>
                    <nav class="pagination-nav">
                        <ul class="pagination">
                            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                                <a class="page-link" th:href="@{/admin/orders(pageNo=${currentPage - 1})}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>
                                    </svg>
                                </a>
                            </li>
                            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages)}" th:classappend="${currentPage == i} ? 'active'">
                                <a class="page-link" th:href="@{/admin/orders(pageNo=${i})}" th:text="${i + 1}">1</a>
                            </li>
                            <li class="page-item" th:classappend="${currentPage == totalPages} ? 'disabled'">
                                <a class="page-link" th:href="@{/admin/orders(pageNo=${currentPage + 1})}">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708"/>
                                    </svg>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Cancel Order Modal -->
<div class="modal fade" id="cancelOrderModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title text-danger d-flex align-items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                        <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767z"/>
                        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0z"/>
                    </svg>
                    Xác nhận hủy đơn hàng
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">Bạn có chắc chắn muốn hủy đơn hàng <strong id="cancelOrderCode" class="text-primary" style="font-family: 'JetBrains Mono', monospace;"></strong>?</p>
                <div class="alert alert-warning mb-0">
                    <small>
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                            <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2"/>
                        </svg>
                        Số lượng tồn kho sẽ được hoàn lại. Hành động này không thể hoàn tác.
                    </small>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                <form id="cancelOrderForm" method="post" class="d-inline">
                    <button type="submit" class="btn btn-danger">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" class="me-1" viewBox="0 0 16 16">
                            <path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"/>
                        </svg>
                        Xác nhận hủy
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="sidebar-overlay" id="sidebarOverlay"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/admin.js}"></script>
<script>
    // Search Order ID
    document.getElementById('searchInput')?.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase();
        const rows = document.querySelectorAll('#ordersTable tbody tr');

        rows.forEach(row => {
            const orderIdCell = row.cells[0];
            if(orderIdCell) {
                const text = orderIdCell.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            }
        });
    });

    // Status Filter
    document.getElementById('statusFilter')?.addEventListener('change', function(e) {
        const status = e.target.value;
        const rows = document.querySelectorAll('#ordersTable tbody tr');

        rows.forEach(row => {
            if (!status || row.dataset.status === status) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });

    // Cancel Order Modal
    const cancelModal = document.getElementById('cancelOrderModal');
    const cancelForm = document.getElementById('cancelOrderForm');
    const cancelOrderCode = document.getElementById('cancelOrderCode');

    document.querySelectorAll('.cancel-order-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            if (this.disabled) return;

            const orderId = this.dataset.orderId;
            const orderCode = this.dataset.orderCode;

            cancelOrderCode.textContent = '#' + orderCode;
            cancelForm.action = '/admin/orders/' + orderId + '/cancel';

            new bootstrap.Modal(cancelModal).show();
        });
    });
</script>
</body>
</html>
